## Vue 双向绑定原理
- mvvm 双向绑定，采用数据劫持结合发布者、订阅者模式。通过`Object.defineProperty()`劫持各个属性的`getter`、`setter`,在数据变动时通知订阅者，出发相应的监听回调。

![mvvm](../images/mvvm.png)

### 要点
- 1.实现一个数据监听器 `Observer` 能够对数据对象的所有属性进行监听，若有变动可拿到最新值并通知订阅者
- 2.实现一个指令解析器 `Compile` 对每个元素节点的指令进行扫描解析，根据指令模板替换数据，以及绑定相应的更新函数。
- 3.实现一个 `Watcher` 作为连接 `Observer`与`Compile`的桥梁，能够订阅并收到每个属性变动的通知，执行指令绑定的相应回调，更新视图。

### 具体步骤
- 1.需要`Observer`的数据对象进行递归遍历，包含子属性对象的属性，都加上 `getter` `setter`,这样在给对象的属性赋值时就会触发`setter`监听到数据变化。
- 2.`Compile`解析模板指令，将模板中的变量替换成数据，然后初始化渲染页面，并绑定对应节点的更新函数，添加监听数据的订阅者，一旦数据变化，收到通知，更新视图
- 3.`Watcher`主要作用为：
    - 在自身实例化时往属性订阅器（Dep）添加自己
    - 自身必须有一个 update 方法
    - 待属性变动 `dep.notice()` 通知时调用自身的update方法，并触发`Compile`中绑定的回调。
- 4.MVVM作为数据双向绑定的入口，整合 Observer、Compile 和 Watcher 三者，通过Observer来监听自己的 model 数据变化，通过 Compile 来解析编译模板指令，最终利用 Watcher 搭起 Observer 和 Compile 之间的通信桥梁，达到数据变化 -> 视图更新；视图交互变化(input) -> 数据 model 变更的双向绑定效果。
